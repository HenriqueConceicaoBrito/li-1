name: GitHub Actions - Workflow run Super Combinado
run-name: Running Workflow run Super Combinado

on:
  workflow_run:
    workflows: ["Trigger"]
    types: [requested, in_progress, completed]
    # branches: [main]  # Opcional: filtro por branch

jobs:
  monitoramento_completo:
    runs-on: ubuntu-latest
    
    steps:
      # Passo 1: Identifica√ß√£o clara do tipo de evento
      - name: Identificador do evento
        run: |
          echo "üéØ EVENTO DETECTADO: ${{ github.event.action }}"
          echo "================================================"
          
          case "${{ github.event.action }}" in
            "requested")
              echo "üü° FASE 1: WORKFLOW SOLICITADO"
              echo "O Trigger foi aceito e est√° na fila de execu√ß√£o"
              ;;
            "in_progress")
              echo "üü† FASE 2: WORKFLOW EM EXECU√á√ÉO"
              echo "O Trigger est√° rodando seus jobs ativamente"
              ;;
            "completed")
              echo "üîµ FASE 3: WORKFLOW CONCLU√çDO"
              echo "O Trigger terminou todos os jobs"
              ;;
          esac
          echo "================================================"
      
      # Passo 2: A√ß√µes espec√≠ficas para REQUESTED
      - name: A√ß√µes para REQUESTED (in√≠cio)
        if: github.event.action == 'requested'
        run: |
          echo "üöÄ A√á√ïES DE INICIALIZA√á√ÉO"
          echo "-------------------------"
          echo "Hora: $(date)"
          echo "Workflow ID: ${{ github.event.workflow_run.id }}"
          echo "Branch: ${{ github.event.workflow_run.head_branch }}"
          echo "Evento original: ${{ github.event.workflow_run.event }}"
          echo ""
          echo "Processos executados:"
          echo "1. ‚úÖ Notifica√ß√£o de in√≠cio ao time"
          echo "2. ‚úÖ Aloca√ß√£o de ambiente de teste"
          echo "3. ‚úÖ Verifica√ß√£o de pr√©-requisitos"
          echo "4. ‚úÖ In√≠cio do log de execu√ß√£o"
          echo "-------------------------"
      
      # Passo 3: A√ß√µes espec√≠ficas para IN_PROGRESS
      - name: A√ß√µes para IN_PROGRESS (durante)
        if: github.event.action == 'in_progress'
        run: |
          echo "üîÑ A√á√ïES DE MONITORAMENTO ATIVO"
          echo "-------------------------"
          echo "Hora: $(date)"
          echo "Status: ${{ github.event.workflow_run.status }}"
          echo "Tentativa: ${{ github.event.workflow_run.run_attempt }}"
          echo ""
          echo "Monitoramento em tempo real:"
          echo "1. üìä Coletando m√©tricas de performance"
          echo "2. üîç Verificando sa√∫de dos jobs"
          echo "3. ‚è±Ô∏è Medindo tempo de execu√ß√£o parcial"
          echo "4. üìà Gerando relat√≥rio intermedi√°rio"
          echo ""
          # Simula√ß√£o de monitoramento ativo
          echo "Simulando coleta de dados..."
          for i in {1..5}; do
            echo "  Coleta $i/5: Job $i em execu√ß√£o..."
            sleep 1
          done
          echo "-------------------------"
      
      # Passo 4: A√ß√µes espec√≠ficas para COMPLETED
      - name: A√ß√µes para COMPLETED (t√©rmino)
        if: github.event.action == 'completed'
        run: |
          echo "üèÅ A√á√ïES DE FINALIZA√á√ÉO"
          echo "-------------------------"
          echo "Hora: $(date)"
          echo "Resultado: ${{ github.event.workflow_run.conclusion }}"
          echo "Dura√ß√£o: De ${{ github.event.workflow_run.created_at }} at√© ${{ github.event.workflow_run.updated_at }}"
          echo "URL completa: ${{ github.event.workflow_run.html_url }}"
          echo ""
          
          # L√≥gica baseada no resultado final
          echo "RESULTADO FINAL: ${{ github.event.workflow_run.conclusion | upcase }}"
          echo ""
          
          if [ "${{ github.event.workflow_run.conclusion }}" = "success" ]; then
            echo "‚úÖ WORKFLOW BEM-SUCEDIDO"
            echo "A√ß√µes p√≥s-sucesso:"
            echo "1. üöÄ Iniciar pipeline de deploy"
            echo "2. üì® Notificar sucesso ao time"
            echo "3. üìä Registrar m√©tricas finais"
            echo "4. üóÑÔ∏è  Arquivar artifacts"
          elif [ "${{ github.event.workflow_run.conclusion }}" = "failure" ]; then
            echo "‚ùå WORKFLOW COM FALHA"
            echo "A√ß√µes p√≥s-falha:"
            echo "1. üö® Acionar procedimento de emerg√™ncia"
            echo "2. üë®‚Äçüíª Notificar desenvolvedores respons√°veis"
            echo "3. üìã Registrar causa raiz do erro"
            echo "4. üîÑ Preparar rollback autom√°tico"
          elif [ "${{ github.event.workflow_run.conclusion }}" = "cancelled" ]; then
            echo "üõë WORKFLOW CANCELADO"
            echo "A√ß√µes p√≥s-cancelamento:"
            echo "1. ‚ÑπÔ∏è Registrar motivo do cancelamento"
            echo "2. üßπ Limpar recursos alocados"
            echo "3. üìù Atualizar documenta√ß√£o"
          else
            echo "‚ö†Ô∏è RESULTADO INESPERADO: ${{ github.event.workflow_run.conclusion }}"
            echo "A√ß√µes gen√©ricas:"
            echo "1. üîé Investigar status"
            echo "2. üìã Registrar para an√°lise"
          fi
          echo "-------------------------"
      
      # Passo 5: Dashboard/resumo final
      - name: Dashboard de execu√ß√£o
        run: |
          echo "üìä DASHBOARD - CICLO COMPLETO DO TRIGGER"
          echo "========================================"
          echo "Workflow Monitor: 24-workflow-run-super-combinado"
          echo "Workflow Alvo: Trigger"
          echo "Evento Atual: ${{ github.event.action }}"
          echo "Status: ${{ github.event.workflow_run.status }}"
          echo ""
          echo "üìà FLUXO COMPLETO MONITORADO:"
          echo "  1. requested ‚Üí In√≠cio/fila"
          echo "  2. in_progress ‚Üí Execu√ß√£o ativa"
          echo "  3. completed ‚Üí T√©rmino"
          echo ""
          echo "‚ö° VANTAGENS DESTA ABORDAGEM:"
          echo "  ‚Ä¢ Um √∫nico arquivo para todo o ciclo"
          echo "  ‚Ä¢ L√≥gica centralizada"
          echo "  ‚Ä¢ F√°cil manuten√ß√£o"
          echo "  ‚Ä¢ Vis√£o completa do pipeline"
          echo ""
          echo "üîÑ ESTE WORKFLOW SER√Å EXECUTADO 3 VEZES:"
          echo "  1¬™ vez: Quando Trigger √© solicitado"
          echo "  2¬™ vez: Quando Trigger come√ßa a executar"
          echo "  3¬™ vez: Quando Trigger termina"
          echo "========================================"
